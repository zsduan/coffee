{"remainingRequest":"D:\\培训\\提交项目\\my-project\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\培训\\提交项目\\my-project\\src\\views\\PlaceOrder.vue?vue&type=style&index=0&id=43a6cca0&lang=less&scoped=true&","dependencies":[{"path":"D:\\培训\\提交项目\\my-project\\src\\views\\PlaceOrder.vue","mtime":1594372830935},{"path":"D:\\培训\\提交项目\\my-project\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\培训\\提交项目\\my-project\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\培训\\提交项目\\my-project\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\培训\\提交项目\\my-project\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\培训\\提交项目\\my-project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\培训\\提交项目\\my-project\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnBsYWNlT3JkZXJ7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiA2NjdweDsKICBiYWNrZ3JvdW5kOiAjZGRkOwogIC53aGl0ewogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDUwcHg7CiAgfQogIC5hZGRyZXNzewogICAgbWFyZ2luLXRvcDogMTBweDsKICAgIG1hcmdpbi1ib3R0b206MTBweDsKICAgIHBhZGRpbmc6MTBweCAwIDEwcHggMTBweDsgCiAgICBiYWNrZ3JvdW5kOiAjZmZmOyAKICAgIGZvbnQtc2l6ZTogMThweDsKICAgIHNwYW57CiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIHBhZGRpbmctYm90dG9tOjEwcHg7IAogICAgfQoKICAgIC5hZGRyZXNzaXRlbXsKICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICBib3JkZXItdG9wOiAxcHggc29saWQgIzAwMDsKICAgICAgLnRpdGxlewogICAgICAgIHBhZGRpbmctbGVmdDogMHB4OwogICAgICAgIHBhZGRpbmctYm90dG9tOiAxMHB4OwogICAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgICAgfQogICAgICBwewogICAgICAgIHBhZGRpbmctbGVmdDogMTVweDsKICAgICAgfQogICAgfQogIH0KCiAgLnNob3dnb29kc3sKICAgIHdpZHRoOiAxMDAlOwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICB9CgogIC50b3RhbHsKICAgIHdpZHRoOiAxMDAlOwogICAgbWFyZ2luLXRvcDogNXB4OwogICAgYmFja2dyb3VuZDogI2ZmZjsKICAgIGNvbG9yOiAjNjY2OwogICAgbWFyZ2luLWJvdHRvbTogNTBweDsKICAgIC5udW17CiAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgIH0KICAgIC5wcmljZXsKICAgICAgZm9udC1zaXplOiAyMHB4OwogICAgICBmb250LXdlaWdodDogMTAwOwogICAgICBwYWRkaW5nLXJpZ2h0OiAxNXB4OwogICAgICBjb2xvcjogIzAwMDsKICAgIH0KICB9Cn0KLm5hdnsKICAgIHdpZHRoOiAxMDAlOwogICAgcG9zaXRpb246IGZpeGVkOwogICAgdG9wOiAwOwogICAgei1pbmRleDogMjsKfQovLyDmj5DkuqTmjInpkq4KLnZhbi1idXR0b257CiAgYmFja2dyb3VuZDogI0ZFODc0RDsKfQo="},{"version":3,"sources":["PlaceOrder.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PlaceOrder.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"placeOrder\">\r\n    <!-- 显示nav -->\r\n    <div>\r\n      <van-nav-bar title=\"确认支付\" left-text=\"返回\"  class=\"nav\" left-arrow @click-left=\"goback\">\r\n      </van-nav-bar>\r\n    </div>\r\n    <div class=\"whit\"></div>\r\n    <div class=\"address\">\r\n      <span @click=\"changeAddress\">请选择收货地址</span>\r\n      <!-- 显示地址 -->\r\n      <div class=\"addressitem\">\r\n        <p class=\"title\">当前地址：</p>\r\n        <p>姓名：{{current.name}}</p>\r\n        <p>电话：{{current.tel}}</p>\r\n        <p>地址：{{current.address}}</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 提交订单 -->\r\n    <van-submit-bar :price=\"this.numprice[1]*100\" button-text=\"立即支付\" @submit=\"sbumitOrder\">\r\n    </van-submit-bar>\r\n\r\n    <!-- 显示商品 -->\r\n    <div class=\"showgoods\">\r\n      <van-card\r\n        v-for=\"(item,index) in commodityData\"\r\n        :num=\"item.count\"\r\n        :price=\"item.price\"\r\n        :desc=\"item.rule\"\r\n        :title=\"item.name\"\r\n        :thumb=\"item.small_img\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 显示总价 -->\r\n    <div class=\"total clearfix\">\r\n      <p class=\"fr\">\r\n        <span>共计<span class=\"num\">{{numprice[0]}}</span>件商品，共计</span>\r\n        <span class=\"price\">￥{{numprice[1]}}</span>\r\n      </p>\r\n    </div>\r\n\r\n        <!-- 提交地址 -->\r\n    <van-action-sheet v-model=\"show\" title=\"请选择地址\">\r\n      <div class=\"content-show\">\r\n        <van-address-list\r\n          v-model=\"chosenAddressId\"\r\n          :list=\"list\"\r\n          default-tag-text=\"默认\"\r\n          @add=\"onAdd\"\r\n          @edit=\"onEdit\"\r\n          @select=\"switchAddress\"\r\n        />\r\n      </div>\r\n    </van-action-sheet>\r\n    \r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Toast } from 'vant';\r\n\r\nexport default {\r\n  name: 'PlaceOrder',\r\n  mounted(){\r\n    // 获得上一个界面的值和获取商品数据\r\n    this.getSidsAndGoods();\r\n    // 获取地址数据\r\n    this.selectAddress();\r\n  },\r\n  data(){\r\n  \treturn{\r\n      // 展示选择地址\r\n      show:false,\r\n      // 地址列表车\r\n      chosenAddressId: '1',\r\n      list: [],\r\n\r\n      // 商品数据\r\n      commodityData:[],\r\n      // 保存商品价格和数量\r\n      numprice:[],\r\n      // 当前地址信息\r\n      current:{},\r\n  \t}\r\n  },\r\n  methods:{\r\n  \t// 回到上一页\r\n    goback(){\r\n      this.$router.go(-1);\r\n    },\r\n    // 新增地址\r\n    onAdd() {\r\n      this.$router.push({name:\"Address\"});\r\n    },\r\n    // 编辑地址\r\n    onEdit(item, index) {\r\n      this.$router.push({name:\"Address\",query:{aid:item.aid}});\r\n    },\r\n    // 选择地址\r\n    changeAddress(){\r\n      this.show = true;\r\n    },\r\n    // 获取上一个界面的数据和处理商品数据\r\n    getSidsAndGoods(){\r\n      // 获取本地数据\r\n      let tokenString = localStorage.getItem(\"__Tk\");\r\n      //判断是否登录\r\n      if (tokenString == undefined) {\r\n        this.$router.push({name:\"Login\"});\r\n      }\r\n      // 获取订单号\r\n      let putsids = localStorage.getItem(\"putsids\");\r\n      \r\n      //开启加载提示\r\n      Toast.loading({\r\n          message: \"加载中...\",\r\n          forbidClick: true,\r\n          //延迟自动关闭加载提示，如果该值为0，则不会自动关闭\r\n          duration: 0\r\n      });\r\n\r\n      // 进行商品数据的获取\r\n      this.axios({\r\n        method:\"get\",\r\n        url:\"http://www.kangliuyong.com:10002/commitShopcart\",\r\n        params:{\r\n          appkey:this.appkey,\r\n          tokenString,\r\n          sids:putsids\r\n        }\r\n      }).then(result =>{\r\n        Toast.clear();\r\n        this.commodityData = result.data.result;\r\n        // 计算商品的总价格\r\n        this.sumtotal();\r\n      }).catch(err =>{\r\n        Toast.clear();\r\n        \r\n      })\r\n    },\r\n    // 计算商品价格\r\n    sumtotal(){\r\n      let sum = 0;\r\n      let price = 0;\r\n\r\n      for (var i = 0; i < this.commodityData.length; i++) {\r\n        sum += this.commodityData[i].count;\r\n\r\n        price += this.commodityData[i].count * this.commodityData[i].price;\r\n      }\r\n\r\n      this.numprice.push(sum);\r\n      this.numprice.push(price);\r\n    },\r\n\r\n    // 查询地址数据\r\n    selectAddress(){\r\n      // 获取本地数据\r\n      let tokenString = localStorage.getItem(\"__Tk\");\r\n\r\n      //开启加载提示\r\n      Toast.loading({\r\n          message: \"加载中...\",\r\n          forbidClick: true,\r\n          //延迟自动关闭加载提示，如果该值为0，则不会自动关闭\r\n          duration: 0\r\n      });\r\n\r\n      // 开始请求\r\n      this.axios({\r\n        method:\"get\",\r\n        url:\"http://www.kangliuyong.com:10002/findAddress\",\r\n        params:{\r\n          appkey:this.appkey,\r\n          tokenString\r\n        }\r\n      }).then(result =>{\r\n        Toast.clear();\r\n        if (result.data.code == 20000) {\r\n          result.data.result.forEach(v => {\r\n            let currentAddress = {\r\n              id:v.id,\r\n              tel:v.tel,\r\n              name:v.name,\r\n              address:v.province + v.county + v.city + v.addressDetail,\r\n              isDefault:Boolean(v.isDefault),\r\n              aid:v.aid\r\n            }\r\n            this.list.push(currentAddress);\r\n          })\r\n          // 判断是否是默认值\r\n          let index = 0; \r\n          for (let i = 0; i < this.list.length; i++) {\r\n            if (this.list[i].isDefault) {\r\n              index = i;\r\n            }\r\n          }\r\n          this.chosenAddressId = this.list[index].id;\r\n          this.current = this.list[index];\r\n        }\r\n      }).catch(err =>{\r\n        Toast.clear();\r\n        \r\n      })\r\n\r\n    },\r\n    // 切换地址\r\n    switchAddress(item,index){\r\n      this.current = item;\r\n      this.show = false;\r\n    },\r\n    // 提交地址\r\n    sbumitOrder(){\r\n      // 获取本地数据\r\n      let tokenString = localStorage.getItem(\"__Tk\");\r\n      // 获取订单号\r\n      let putsids = localStorage.getItem(\"putsids\");\r\n\r\n      //开启加载提示\r\n      Toast.loading({\r\n          message: \"加载中...\",\r\n          forbidClick: true,\r\n          //延迟自动关闭加载提示，如果该值为0，则不会自动关闭\r\n          duration: 0\r\n      });\r\n\r\n      this.axios({\r\n        method:\"POST\",\r\n        url:\"http://www.kangliuyong.com:10002/pay\",\r\n        data:{\r\n          appkey:this.appkey,\r\n          tokenString,\r\n          sids:putsids,\r\n          phone:this.current.tel,\r\n          address:this.current.address,\r\n          receiver:this.current.name\r\n        }\r\n      }).then(result => {\r\n        Toast.clear();\r\n        if (result.data.code == 60000) {\r\n          Toast(result.data.msg);\r\n          this.$router.push({name:\"Order\"})\r\n        }\r\n      }).catch(err => {\r\n        Toast.clear();\r\n        \r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .placeOrder{\r\n    width: 100%;\r\n    height: 667px;\r\n    background: #ddd;\r\n    .whit{\r\n      width: 100%;\r\n      height: 50px;\r\n    }\r\n    .address{\r\n      margin-top: 10px;\r\n      margin-bottom:10px;\r\n      padding:10px 0 10px 10px; \r\n      background: #fff; \r\n      font-size: 18px;\r\n      span{\r\n        display: inline-block;\r\n        width: 100%;\r\n        padding-bottom:10px; \r\n      }\r\n\r\n      .addressitem{\r\n        font-size: 14px;\r\n        border-top: 1px solid #000;\r\n        .title{\r\n          padding-left: 0px;\r\n          padding-bottom: 10px;\r\n          font-size: 16px;\r\n        }\r\n        p{\r\n          padding-left: 15px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .showgoods{\r\n      width: 100%;\r\n      border-radius: 10px;\r\n    }\r\n\r\n    .total{\r\n      width: 100%;\r\n      margin-top: 5px;\r\n      background: #fff;\r\n      color: #666;\r\n      margin-bottom: 50px;\r\n      .num{\r\n        font-size: 16px;\r\n      }\r\n      .price{\r\n        font-size: 20px;\r\n        font-weight: 100;\r\n        padding-right: 15px;\r\n        color: #000;\r\n      }\r\n    }\r\n  }\r\n  .nav{\r\n      width: 100%;\r\n      position: fixed;\r\n      top: 0;\r\n      z-index: 2;\r\n  }\r\n  // 提交按钮\r\n  .van-button{\r\n    background: #FE874D;\r\n  }\r\n</style>"]}]}